<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>各种类型的sql注入原理 | z3p.l0ve</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://zpdad26.github.io//favicon.ico?v=1606818185033">
<link rel="stylesheet" href="https://zpdad26.github.io//styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="本文讲述常见的sql注入基本类型的原理，具体的例子就以后由题目再进行总结吧。
目录
最基础的注入-union注入攻击
Boolean注入攻击-布尔盲注
报错注入攻击
时间注入攻击-时间盲注
堆叠查询注入攻击
二次注入攻击
宽字节注入攻击
b..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://zpdad26.github.io/">
        <img src="https://zpdad26.github.io//images/avatar.png?v=1606818185033" class="site-logo">
        <h1 class="site-title">z3p.l0ve</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      NO PATCH FOR STUPID!
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://zpdad26.github.io//atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">各种类型的sql注入原理</h2>
            <div class="post-date">2020-12-01</div>
            
              <div class="feature-container" style="background-image: url('https://zpdad26.github.io//post-images/ge-chong-lei-xing-de-sql-zhu-ru-yuan-li.jpg')">
              </div>
            
            <div class="post-content" v-pre>
              <p>本文讲述常见的sql注入基本类型的原理，具体的例子就以后由题目再进行总结吧。</p>
<h2 id="目录">目录</h2>
<pre><code>最基础的注入-union注入攻击
Boolean注入攻击-布尔盲注
报错注入攻击
时间注入攻击-时间盲注
堆叠查询注入攻击
二次注入攻击
宽字节注入攻击
base64注入攻击
cookie注入攻击-http请求头参数注入
XFF注入攻击-http请求头参数注入
知道绝对路径的注入
</code></pre>
<h3 id="1union">1.UNION</h3>
<p>UNION操作符用于合并两个或多个SELECT语句的结果集，而且UNION内部的SELECT语句必须拥有相同数量的列，列也必须拥有相似的数据类型，同时，每条SELCCT语句中的列的顺序必须相同</p>
<h4 id="流程">流程：</h4>
<p>1.确保两张表结构一致<br>
2.判断时字符型注入还是数字型注入<br>
3.使用ORDER BY 查询列数。<br>
4.获取数据库名。<br>
5.获取数据库中的所有表名。<br>
6.获取数据库的表中的所有字段名<br>
7.获取字段中的数据</p>
<h3 id="2boolean注入攻击-布尔盲注">2.Boolean注入攻击-布尔盲注</h3>
<p>查看现象，能报错，但没有报错信息，正确查询也显示不了查询内容就属于布尔盲注，只存在两种状态，对或错；<br>
由页面的两种不同返回的状态来判定我们的闭合规则；<br>
为了方便，我们这里假设返回正确用“yes”，返回错误用“no”来表示这两种状态<br>
找到闭合规则后，我们在闭合规则里面  and 1=1 和 and 1=2 测试一下，看看最后返回是不是两种状态；<br>
布尔盲注要用到<code>length()和substr()</code>语句，用两种状态来猜解数据库、表名等的长度和正确字母；<br>
先用 <code>and length(database())&gt;2</code>来猜数据库的长度，使用的是二分法；<br>
再用 <code>and substr(database(),1,1)='t'</code> 来确定第一个字母，可用burp跑，26个字母,哪个字母返回yes则代表第一个字母就是它；<br>
and substr(database(),2,1)='t' 代表当前数据库的第二个字母；<br>
最后结合长度，成功的将数据库猜解出来；<br>
后面的操作跟union注入的步骤差不多了，只是sql语句写在 上文的 database() 处。</p>
<h3 id="3报错注入攻击">3.报错注入攻击</h3>
<p>1.只要注入点有sql报错信息，那么就可以使用报错注入；<br>
2.还是一样，引号报错，然后找到闭合规则，页面正常显示，则可以在闭合规则中开始写入报错注入的sql语句；<br>
3.updatexml报错获取当前数据库：</p>
<pre><code>and updatexml(1,concat(0x7e,(select database()),0x7e),1)
</code></pre>
<p>4.floor报错获取当前数据库：</p>
<pre><code>and (select 1 from (select count(*),concat((database()),floor (rand(0)*2))x from information_schema.tables group by x)a)
</code></pre>
<p>5.两种方式都可行，如果第一个不行就试试第二个<br>
6.接着可以利用select语句替换掉上面database()来继续获取数据库中的表名、字段名，查询语句和union注入攻击的语句相同；<br>
7.只不过这里不能再使用group_concat了，因为报错注入只显示一条结果，所以需要使用limit语句；</p>
<h3 id="4时间注入攻击-时间盲注">4.时间注入攻击-时间盲注</h3>
<p>没有明确的现象，不管是对是错都返回一个状态；<br>
但是如果用sleep(5)方法，能让响应时间延迟为5秒以上，那么就为时间盲注；<br>
1.我们用sleep(5)函数构造了一个时间延时的状态，因此，我们又有了两种状态，像布尔盲注一样可以根据这两种状态来判定数据库、表名和字段名的长度和正确的每个字母；<br>
2.同样的找到正确的闭合规则，当然，这个闭合规则得配合着 and sleep(5)语句来构造，哪一个闭合规则执行了sleep(5)，那么就是正确得闭合规则；<br>
3.时间盲注配合着  if(A,B,C)  语句结合使用，含义是：如果A是 true，则返回B（也就是执行B），否则返回C（执行C）；<br>
那么判断当前数据库名的长度的语句为：</p>
<pre><code> if (length(database())&gt;1,sleep(5),1)
</code></pre>
<p>就是说如果数据库长度大于1，那么响应延时5秒，否则执行select 1(也就是不延时)，由此来推出数据库长度。<br>
判断当前数据库名的第一个和第二个字母的语句：</p>
<pre><code>    if(substr(database(),1,1)='s',sleep(5),1)

    if(substr(database(),2,1)='s',sleep(5),1)
</code></pre>
<p>只有第一个字母等于26个字母中正确的字母时，才会延时5秒，因此可以通过burp或者sqlmap来跑。<br>
根据数据库名长度以此内推即可得出完整的数据库的库命、表名、字段名和具体内容。</p>
<h3 id="5堆叠查询注入攻击">5.堆叠查询注入攻击</h3>
<p>1.可以使用堆叠注入的地方也可以使用布尔盲注与时间盲注；<br>
2.同样先找出正确的闭合规则，然后也看两种状态来猜解库名、表名等；<br>
3. 堆叠注入的语句为</p>
<pre><code>    ;select if(length(database())&gt;1,sleep(3),1)
    ;select if(substr(database(),1,1)='r',sleep(3),1)
</code></pre>
<p>按照原理来说，分号后面可以执行新sql语句，但是很多时候没必要，如果遇到其他注入方法（或者绕过方式）不行的情况下可以试试这个注入方式；不是很常用。</p>
<h3 id="6二次注入攻击">6.二次注入攻击</h3>
<p>二次注入一共有两个url，url一用来注入，也就是注入点，插入sql语句的地方，另外一个url用来返回信息；</p>
<!-- more -->
<p>也就是url一插入了sql语句，url一的响应里面就会返回这条信息对应的id值，然后url二就传入这个新id值，然后访问，响应回来之后将会爆出sql语句查询的结果，正确或者错误的sql信息；</p>
<!-- more -->
<p>就相当于url是一个用户注册的地方，用户注册后会在数据库里面加入新id存放用户的注册信息，那么这个id可以传给url二来访问，url二就可以显示出用户的注册信息，但如果注册信息含义恶意sql语句，url二就会显示出敏感的数据库信息；</p>
<!-- more -->
<p>跟union注入攻击差不多，只是回显的信息需要在另外的url中显示出来了；</p>
<!-- more -->
<p>后面就是union注入攻击的常规操作。</p>
<h3 id="7宽字节注入攻击">7.宽字节注入攻击</h3>
<p>如果遇到单、双引号被转义，变成了反斜杠，导致参数id无法逃逸单引号的包围；<br>
一般情况下，此处就不存在sql注入漏洞的；</p>
<!-- more -->
<p>但是如果数据库的编码为GBK时，就可以使用宽字节注入，因此在不知道是否是GBK编码时，都可以尝试去使用宽字节注入；</p>
<!-- more -->
<p>宽字节的格式是在地址后先加一个 <code>%df</code>,</p>
<!-- more -->
<p>再加单引号，因为反斜杠的编码为%5c，在GBK编码中，<code>%df%5c</code>是繁体字“連”，因此，单引号成功逃逸，爆出sql错误；</p>
<!-- more -->
<p>因此构造闭合规则时，在单引号前面加上  %df 就行了；</p>
<!-- more -->
<p>之后在闭合规则中写入同union注入的一些查询语句就行了；</p>
<h3 id="8base64注入攻击">8.base64注入攻击</h3>
<p>如果遇到url的参数id的值看起来像base64的，先拿去url解码，然后如果是base64，拿去base64解码，解出来的应该就是id的值（1，2等数字）；</p>
<!-- more -->
<p>那么如果要对这个url进行sql注入测试，就需要对id后面的所有值进行base64编码；</p>
<!-- more -->
<p>注入的方式步骤都是跟union注入一样的，只不过后面的所有值（整个payload）都要进行base64编码后传给url的c参数提交，包括闭合规则。</p>
<h3 id="9http请求头参数注入-cookie注入攻击">9.HTTP请求头参数注入-cookie注入攻击</h3>
<p>包对一个url的http请求头的所有参数进行sql注入测试，里面的所有参数都有可能存在注入点，如果响应包出现sql报错，那么测试的这个参数就是注入点；<br>
常见的http头部注入的参数有：</p>
<!-- more -->
<pre><code>【Referer】、【X-Forwarded-For】、【Cookie】、【X-Real-IP】、【Accept-Language】、【Authorization】
</code></pre>
<!-- more -->
<p>如果测试到cookie参数的时候，响应有报sql错误，那么就是cookie注入攻击；<br>
和union注入的差别就在于注入点不一样，之后使用union注入的方法即可。</p>
<h3 id="10http请求头参数注入-xff注入攻击">10.HTTP请求头参数注入-XFF注入攻击</h3>
<p>XFF注入即HTTP头部的<code>X-Forwarded-for</code>参数存在sql注入；</p>
<!-- more -->
<p>例如测试此参数的值 <code>X-Forwarded-for:127.0.0.1'</code>  响应有sql报错，那么此处就是注入点；</p>
<!-- more -->
<p>之后使用union注入的方法完成即可。</p>
<p>###11.知道绝对路径的注入<br>
如果通过一些方式爆出了网站的根目录，并且知道此站点存在sql注入；</p>
<!-- more -->
<p>猜测此数据库可能有file权限，那么我们就可以使用语句：<code>into outfile</code> 来写shell到网站的根目录下，之后用菜刀连接；</p>
<!-- more -->
<p>如果数据库没有file权限，那么我们用sqlmap的参数 <code>--is-dba</code>  来查看当前数据库的用户是否有管理员权限；</p>
<!-- more -->
<p>如果有管理员权限，我们就可以使用sqlmap里面的参数命令<code>--os-shell</code>  来上传、反弹shell，最终getshell；</p>
<!-- more -->
<p>如果file、管理员权限都没有，那么另寻思路，日志、缓存写入等。</p>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://zpdad26.github.io/post/mysql-ji-chu-yu-fa/">
                  <h3 class="post-title">
                    mysql基础语法
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
